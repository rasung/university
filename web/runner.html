<html>
  <head>
    <title>runner</title>
  </head>


  <body onload="init()" onkeydown="canvas.character.character_state_on()" onkeyup="canvas.character.character_state_off()">
    <canvas id="myCanvas" width="1200" height="500"></canvas>

    <script>

    var Character_state = 0; //if 0 = no keyinput if 1 = keyinput
    var canvas; // canvas object has block, coin and character instance reference (Directed assosiation relaition)


    function Canvas (width, height) {
      this.ctx;
      this.blocks = []; // has block instances
      this.coins = []; // has coin instances
      this.character; // has character instance
      this.width = width;
      this.height = height;

      this.initSize = function () {
        document.getElementById("myCanvas").style.width = this.width;
        document.getElementById("myCanvas").style.height = this.height;
      };

      this.addBlock = function (block) { // add new block instance to array
        this.blocks.push(block);
      };

      this.addCoin = function (coin) { // add new coin instance to array
        this.coins.push(coin);
      };

      this.setCharacter = function (chracter) { //select character
        this.character = chracter;
      };
    }

    function Block (x, y, width, height, color) {
      this.x = x;
      this.y = y;
      this.width = width;
      this.height = height;
      this.color = color;

      this.draw = function () {
        canvas.ctx.fillStyle = this.color;
        canvas.ctx.fillRect(this.x, this.y, this.width, this.height);
      };

      this.move = function () {
        this.x -= 1;
      };
    }

    function Coin (x, y, color, radius) {
      this.x = x;
      this.y = y;
      this.color = color;
      this.radius = radius;

      this.draw = function () {
        canvas.ctx.beginPath();
        canvas.ctx.fillStyle = this.color;
        canvas.ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2, true);
        canvas.ctx.closePath();
        canvas.ctx.fill();
      };

      this.move = function () {
        this.x -= 1;
      };
    }

    function Character (x, y, width, height, identity) {
      this.x = x;
      this.y = y;
      this.width = width;
      this.height = height;
      this.image = new Image();
      this.image.src = 'character' + identity + '.jpg';

      this.draw = function () {
        canvas.ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
      }

      this.move = function () { // if no keyinput and character is not at the bottom, character moves to bottom
        if (Character_state == 0) {
          if ((this.y + this.height) < 500) {
            this.y += 2;
          }
        }
        else {
          this.y -= 2;
        }
      };

      this.character_state_on  = function () {
          Character_state = 1;
      };

      this.character_state_off = function () {
          Character_state = 0;
      };
    }

    function init () {
      var character;

      canvas = new Canvas(1200, 500);
      canvas.initSize();
      canvas.ctx = document.getElementById('myCanvas').getContext('2d');

      character = new Character(50, 400, 50, 100, 1);
      canvas.setCharacter(character);

      setIntervals();
    }

    function setIntervals () { // interupts
      setInterval(function () { // erase, move and draw blocks, coins, character
        var i;
        canvas.ctx.clearRect(0, 0, 1200, 500);
        for (i=0; i<canvas.blocks.length; i++) {
          canvas.blocks[i].move();
          canvas.blocks[i].draw();
        }
        for (i=0; i<canvas.coins.length; i++) {
          canvas.coins[i].move();
          canvas.coins[i].draw();
        }
        canvas.character.move();
        canvas.character.draw();
      }, 10);

      setInterval(function () { // make new blocks and add to array
        var block = new Block(1150, 300, 25, canvas.height-300, 'blue');
        canvas.addBlock(block);
      }, 3000);

      setInterval(function () { // make new coins and add to array
        var coin = new Coin(1150, 250, 'yellow', 12);
        canvas.addCoin(coin);
      }, 500);

      setInterval(function () { // erase passed block
        if (canvas.blocks[0].x <= 0) {
          canvas.blocks.shift();
        }
      }, 10);

      setInterval(function () { // erase passed coin
        if (canvas.coins[0].x <= 0) {
          canvas.coins.shift();
        }
      }, 10);

      setInterval(ifBlockTouch, 10); // if character touch blocks

      setInterval(ifCoinTouch, 10);// if character touch coins

    }

    function ifBlockTouch() { // when touch blocks[i]
      for (var i=0; i<canvas.coins.length; i++) {
        var block_side = canvas.blocks[0].x;
        var entry_point = canvas.character.x + canvas.character.width;
        var exit_point = canvas.character.x - canvas.blocks[0].width;
        var character_bottom = canvas.character.y + canvas.character.height;
        var block_top = canvas.blocks[0].y;

        if (block_side <= entry_point && block_side >= exit_point) {
          if (character_bottom > block_top) {
            canvas.blocks.splice(i,1);
          }
        }
      }
    }


    function ifCoinTouch() { // when touch coins[i]
      for (var i=0; i<canvas.coins.length; i++) {
        var coin_side = canvas.coins[i].x;
        var entry_point = canvas.character.x + canvas.character.width;
        var exit_point = canvas.character.x - (canvas.coins[i].radius)/2;
        var character_top = canvas.character.y;
        var character_bottom = canvas.character.y + canvas.character.height;
        var coin_top = canvas.coins[i].y - (canvas.coins[i].radius)/2;
        var coin_bottom = canvas.coins[i].y + (canvas.coins[i].radius)/2;

        if (coin_side <= entry_point && coin_side >= exit_point) {
          if (character_bottom >= coin_top && character_top <= coin_bottom) {
            canvas.coins.splice(i,1);
          }
        }
      }
    }




    </script>
  </body>
</html>
